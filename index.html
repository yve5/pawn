<!doctype html> <html> <head> <meta charset="utf-8"> <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"> <style>html{font-family:'Segoe UI',sans-serif;text-align:center;display:table;height:100%;width:100%}html body{background-color:#aaa;vertical-align:middle;display:table-cell;padding:0;margin:0}.container{background-color:#fff;position:relative;overflow:hidden;margin:auto;height:500px;width:800px}@media only screen and (max-device-width:800px) and (-webkit-min-device-pixel-ratio:2){.container{width:320px;height:568.88888889px}}.grid{height:1920px;width:1920px;background-color:#0482d4;background-size:100px 100px,100px 100px,20px 20px,20px 20px;background-position:-2px -2px,-2px -2px,-1px -1px,-1px -1px;background-image:linear-gradient(#0b4fd3 2px,transparent 2px),linear-gradient(90deg,#0b4fd3 2px,transparent 2px),linear-gradient(#0072bc 1px,transparent 1px),linear-gradient(90deg,#0072bc 1px,transparent 1px)}.player{background-color:#0f0;height:70px;width:70px}.debugger{background-color:rgba(0,255,0,.4);text-align:right;position:absolute;right:0;top:0;border-radius:0 0 0 5px;padding:5px}</style> <title>Pawn</title> </head> <body> <div class="container"> <div id="grid" class="grid"> <div id="player" class="player"></div> </div> </div> <div id="debugger" class="debugger"></div> <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js"></script> <script>function handleStart(o){lastY=o.touches[0].clientY,lastX=o.touches[0].clientX,tapped?(clearTimeout(tapped),tapped=null,$("#player").css({background:"red"})):tapped=setTimeout(function(){tapped=null},400)}function handleEnd(o){keys[37]=!1,keys[38]=!1,keys[39]=!1,keys[40]=!1,lockedMove=null,offset=0}function handleCancel(o){console.log("handleCancel",o)}function handleMove(o){currentY=o.touches[0].clientY,currentX=o.touches[0].clientX,null===lockedMove&&(currentY>lastY+approx?(keys[40]=!0,lockedMove=40):currentY<lastY-approx&&(keys[38]=!0,lockedMove=38),currentX>lastX+approx?(keys[39]=!0,lockedMove=39):currentX<lastX-approx&&(keys[37]=!0,lockedMove=37)),lastY=currentY,lastX=currentX}function gameLoop(){whatKey(),$("#player").css({transform:"translate("+playerPositionX+"px, "+playerPositionY+"px)"}),$("#grid").css({transform:"translate("+gridPositionX+"px, "+gridPositionY+"px)"}),$("#debugger").html("Player: "+playerPositionX+" "+playerPositionY+"<br>Grid: "+gridPositionX+" "+gridPositionY+"<br>Delta: "+(gridPositionX+playerPositionX)+" "+(gridPositionY+playerPositionY)),requestAnimationFrame(gameLoop)}function whatKey(){null!==lockedMove&&offset<=10&&(offset+=1),keys[37]&&37===lockedMove&&(playerPositionX>0&&(playerPositionX-=offset),gridPositionX+playerPositionX<insight&&gridPositionX<0&&(gridPositionX+=offset)),keys[38]&&38===lockedMove&&(playerPositionY>0&&(playerPositionY-=offset),gridPositionY+playerPositionY<insight&&gridPositionY<0&&(gridPositionY+=offset)),keys[39]&&39===lockedMove&&(playerPositionX<1850&&(playerPositionX+=offset),gridPositionX+playerPositionX>730-insight&&-1*gridPositionX<1120&&(gridPositionX-=offset)),keys[40]&&40===lockedMove&&(playerPositionY<1850&&(playerPositionY+=offset),gridPositionY+playerPositionY>430-insight&&-1*gridPositionY<1420&&(gridPositionY-=offset)),keys[32]&&$("#player").css({background:"pink"})}var supportsTouch="ontouchstart"in window||navigator.msMaxTouchPoints,tapped=!1,currentY,currentX,lastY,lastX,approx=5,gridPositionX=0,gridPositionY=0,playerPositionX=0,playerPositionY=0,offset=0,insight=160,keys=[],maxSpeed=300,lockedMove=null;window.onload=function(){supportsTouch&&(document.addEventListener("touchstart",handleStart,!1),document.addEventListener("touchend",handleEnd,!1),document.addEventListener("touchcancel",handleCancel,!1),document.addEventListener("touchmove",handleMove,!1),console.log("supportsTouch")),gameLoop()},window.addEventListener("keydown",function(o){null===lockedMove&&(keys[o.keyCode]=!0,lockedMove=o.keyCode)}),window.addEventListener("keyup",function(o){keys[o.keyCode]=!1,lockedMove=null,offset=0})</script> </body> </html>